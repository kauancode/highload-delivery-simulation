config:
  target: "http://localhost:3000"
  phases:
    - duration: 30
      arrivalRate: 10
      name: "Aquecimento"
    - duration: 60
      arrivalRate: 30
      rampTo: 60
      name: "Escalada"
    - duration: 30
      arrivalRate: 80
      name: "Estresse"
  defaults:
    headers:
      Content-Type: "application/json"
  processor: "./processor.cjs"
  ensure:
    - condition: "http.response_time.p95 < 1000"
      message: "95% das requisições devem responder em < 1s"
    - condition: "http.response_time.max < 3000"
      message: "Nenhuma requisição pode ultrapassar 3s"
    - condition: "http.codes.200.rate > 0.95"
      message: "Mais de 95% das respostas devem ser 200"
scenarios:
  - name: "Fluxo completo de pedido"
    flow:
      - function: "fetchRandomRestaurant"
      - function: "setRandomCustomer"
      - function: "setRandomProducts"
      - function: "setRandomAddress"
      - post:
          url: "/orders"
          json:
            customerId: "{{ customerId }}"
            restaurantId: "{{ restaurantId }}"
            items: "{{ items }}"
            address: "{{ address }}"
          capture:
            - json: "$._id"
              as: orderId
      - think: 5
      - function: "checkOrderStatus"
  - name: "Cliente impaciente"
    flow:
      - function: "fetchRandomRestaurant"
      - function: "setRandomCustomer"
      - function: "setRandomProducts"
      - function: "setRandomAddress"
      - post:
          url: "/orders"
          json:
            customerId: "{{ customerId }}"
            restaurantId: "{{ restaurantId }}"
            items: "{{ items }}"
            address: "{{ address }}"
          capture:
            - json: "$._id"
              as: orderId
      - loop:
          - think: 2
          - function: "checkOrderStatus"
        count: 3
